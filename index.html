<!DOCTYPE html>


<head>

    <script src="https://d3js.org/d3.v6.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/milligram/1.4.1/milligram.css">
    <link rel="stylesheet" type="text/css" href="style.css" />

</head>

<body>

    <label for="group-by">Group By</label>
    <select id="group-by">
        <option value="stores">Stores worldwide</option>
        <option value="revenue">Revenue in billion U.S. dollars</option>
    </select>

    <button id="sort-btn">Sort</button>


    <div class="chart">

    </div>
   
    



</body>


<script>


    const margin = ({ top: 20, right: 20, bottom: 20, left: 20 })
    const width = 650 - margin.left - margin.right,
            height = 500 - margin.top - margin.bottom;


    let svg = d3.select(".chart").append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
    
    const xScale = d3.scaleBand()
            //.domain(companies)
            .rangeRound([0, width])
            .paddingInner(0.1);

    const yScale = d3.scaleLinear()
            //.domain([0, d3.max(data.map(d => d.stores))])
            .range([height, 0])
    
    let xAxis = d3.axisBottom()
            .scale(xScale)


        let yAxis = d3.axisLeft()
            .scale(yScale)
            .ticks(10, "s")
    
    svg.append("g")
        .attr("class", "axis x-axis")
        .attr("transform", `translate(0, ${height})`);

    svg.append("g")
        .attr("class", "axis y-axis")
        //.attr("transform", `translate(0, ${width})`);

   
    // svg.append("text")
    //     .attr("class", "y-label")
    //     .attr("text-anchor", "start")
    //     .attr("y", -5)
    //     .attr("x", -margin.left);    

    var sort = false;


    function update(data, type, sort) {


        if (sort % 2 == 0) {
            data.sort(function(a, b){
                console.log("a: ", a, "and b:", b)
                return a[type] - b[type];
            })
        } else {
            data.sort(function(a, b){
                return b[type] - a[type];
            })
        }
        
        // Update the scale domains
        xScale.domain(data.map(d=>d.company));

        yScale.domain([0, d3.max(data.map(d => d[type]))]);


        // Implement the enter-update-exit sequence
        const bars = svg.selectAll('.bars')
            .data(data)
        
        bars.exit()
            .remove()
            
            
        bars.enter()
            .append("rect")
            .attr("class", "bars")
            .merge(bars)
            .transition()
            .duration(1000)
            .attr("x", function (d) {
                console.log("logging x: ", xScale(d.company));
                return xScale(d.company);
            })
            .attr("width", xScale.bandwidth())
            
            
            .attr("y", function (d) {
                return yScale(d[type]);
            })
            .attr("height", function (d) {
                // console.log("D: ", d)
                // console.log("stores: ", d.stores)
                return height - yScale(d[type]);
            })
            .attr("fill", "steelblue")
        
        bars.exit()
            .remove()
            
        
        
    
        //update the axes and the axis title
        
        
        svg.select(".x-axis")
            .transition()
            .call(xAxis)
        
        svg.select(".y-axis")
            .transition()
            .call(yAxis)
        
        svg.selectAll("text")
            .exit()
            .remove()
            
        svg.append("text")
            .attr('x', 10)
            .attr('y', 0)
            .attr("class", "yax")
            .text(type)

        svg.append("text")
            .attr('x', width - 50)
            .attr('y', height - 30)
            .text("Company")

        


        
            

        

        




    } // end of update data function 






    d3.csv('coffee-house-chains.csv', d => {
        return d3.autoType(d)
    }).then(data => {


        console.log("DATA: ", data);
    
        
        let type = document.querySelector("#group-by").value
        
        var sorted = 0
        
        update(data, type, sorted)

        console.log("Here: ", type.value)
        d3.select('#group-by')
            .on("change", function(d){
                type = document.querySelector("#group-by").value
                console.log("d: ", d.target.value);
                d3.selectAll(".bars")
                    
                update(data, d.target.value, sorted)
            });
        
        d3.select("#sort-btn")
            .on("click", function(d){
                sorted+=1;
                update(data, type, sorted)
            })

        
        

        

        

        



    })//  END OF CSV PARSING



</script>







</html>